#!/bin/sh

#===========================
#FOR:BUILD
#===========================
 
require_package cloudinitpatch 
require_package newpack

#===========================
#FOR:RUN
#===========================
 
# Copy the package contents to the filesystem root

# Execute seed-user-data.sh at startup, uses supported-providers-list

#mkdir ${ROOT}/etc/rc.d/init.d
cp /tmp/cloudinitpatch/seed-user-data ${ROOT}/etc/rc.d/init.d
chmod 0744 ${ROOT}/etc/rc.d/init.d/seed-user-data
sed -i '$d' ${ROOT}/etc/init.d/cernvm
echo "chkconfig --add seed-user-data" >> ${ROOT}/etc/init.d/cernvm
echo 'exit $RETVAL' >> ${ROOT}/etc/init.d/cernvm

cp /tmp/cloudinitpatch/supported-providers-list ${ROOT}/var/lib/

# Copy __init__.py and amiconfig.py

#mkdir -p ${ROOT}/usr/lib/python2.6/site-packages/cloudinit/handlers
cp -R /tmp/cloudinitpatch/cloudinit/handlers/* ${ROOT}/usr/lib/python2.6/site-packages/cloudinit/handlers
